<!doctype html>
<meta charset="utf-8">
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>
<style>

.single-hex {
  fill: #64c7cc;
  pointer-events: all;
  cursor: pointer;
}

.single-hex path {
  -webkit-transition: fill 250ms linear;
  transition: fill 250ms linear;
}

.single-hex :hover {
  fill: #444;
}

.mesh {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
  pointer-events: none;
}

.border {
  stroke: #fff;
  stroke-width: 5px;
}

</style>
<body>
</body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 5000,
    height = 5000,
    radius = 150,
    xDiff = 711.69,
    yDiff = 619;

    var topology = hexTopology(radius, width, height);

    var projection = hexProjection(radius);

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    var singleHex = svg.append("g")
        .attr("class", "hexagon")
      .selectAll("g.single-hex")
        .data(topology.objects.hexagons.geometries)
      .enter().append('g').attr('class', 'single-hex');

    singleHex.append("path")
        .attr("d", function(d) { return path(topojson.feature(topology, d)); })
        .attr("data-loc", function(d){ return d.loc.i +',' + d.loc.j; })
        .attr("data-array-loc", function(d){ return d.arrayLoc.i +',' + d.arrayLoc.j; })
        .on("mousedown", mousedown);

    singleHex.append('text').text('hullo');

    svg.append("path")
        .datum(topojson.mesh(topology, topology.objects.hexagons))
        .attr("class", "mesh")
        .attr("d", path);

    function mousedown(d) {
      d3.select(this).attr("class", "border");
      if (d.arrayLoc.j % 2 == 1) {
        window.scrollTo(d.loc.i-xDiff, d.loc.j-yDiff);
      } else {
        window.scrollTo(d.loc.i-xDiff+d.arrayLoc.dx/2, d.loc.j-yDiff);
      }

    }

    function hexTopology(radius, width, height) {
      var dx = radius * 2 * Math.sin(Math.PI / 3),
          dy = radius * 1.5,
          m = Math.ceil((height + radius) / dy) + 1,
          n = Math.ceil(width / dx) + 1,
          geometries = [],
          arcs = [];

      for (var j = -1; j <= m; ++j) {
        for (var i = -1; i <= n; ++i) {
          var y = j * 2, x = (i + (j & 1) / 2) * 2;
          arcs.push([[x, y - 1], [1, 1]], [[x + 1, y], [0, 1]], [[x + 1, y + 1], [-1, 1]]);
        }
      }

      for (var j = 0, q = 3; j < m; ++j, q += 6) {
        for (var i = 0; i < n; ++i, q += 3) {
          geometries.push({
            type: "Polygon",
            arrayLoc: {i:i, j:j, dx:dx},
            loc: {i:i*dx, j:j*dy}, //figure out what actually goes here
            arcs: [[q, q + 1, q + 2, ~(q + (n + 2 - (j & 1)) * 3), ~(q - 2), ~(q - (n + 2 + (j & 1)) * 3 + 2)]]
          });
        }
      }

      return {
        transform: {translate: [0, 0], scale: [1, 1]},
        objects: {hexagons: {type: "GeometryCollection", geometries: geometries}},
        arcs: arcs
      };
    }

    function hexProjection(radius) {
      var dx = radius * 2 * Math.sin(Math.PI / 3),
          dy = radius * 1.5;
      return {
        stream: function(stream) {
          return {
            point: function(x, y) { stream.point(x * dx / 2, (y - (2 - (y & 1)) / 3) * dy / 2); },
            lineStart: function() { stream.lineStart(); },
            lineEnd: function() { stream.lineEnd(); },
            polygonStart: function() { stream.polygonStart(); },
            polygonEnd: function() { stream.polygonEnd(); }
          };
        }
      };
    }


</script>


<script type="text/javascript" charset="utf-8">
window.scrollTo(2406, 2306);

var keys = [37, 38, 39, 40];

function preventDefault(e) {
  e = e || window.event;
  if (e.preventDefault)
      e.preventDefault();
  e.returnValue = false;
}

function keydown(e) {
    for (var i = keys.length; i--;) {
        if (e.keyCode === keys[i]) {
            preventDefault(e);
            return;
        }
    }
}

function wheel(e) {
  preventDefault(e);
}

function disable_scroll() {
  if (window.addEventListener) {
      window.addEventListener('DOMMouseScroll', wheel, false);
  }
  window.onmousewheel = document.onmousewheel = wheel;
  document.onkeydown = keydown;
}

disable_scroll();










</script>
</html>
